# 快速登录指南

## 问题症状

前端页面可以访问，但使用飞书账号登录时提示"用户不存在"。

## 原因

系统使用飞书多维表格存储用户数据，只有在「员工信息」表中添加了你的飞书用户ID的用户才能登录。

## 解决方案

### 方法一：自动添加当前用户（推荐）

#### 1. 获取你的飞书用户ID

浏览器访问:
```
http://localhost:3001/api/auth/login
```

使用你的飞书账号登录后，会跳转到登录失败页面。

#### 2. 查看后端日志

在后端terminal中找到类似这样的日志：
```
用户登录成功: xxx (ou_xxxxxxxxxxxxxxx)
```
或者
```
获取用户信息失败: 用户不存在
[之前会显示获取到的用户ID]
```

记下你的用户ID（格式：`ou_xxxxxxxxxxxxxxx`）

#### 3. 添加你的用户ID到系统

```bash
cd backend
npm run add:me -- ou_xxxxxxxxxxxxxxx
```

将 `ou_xxxxxxxxxxxxxxx` 替换为你在步骤2中获取的真实用户ID。

#### 4. 完善用户信息

打开飞书多维表格「员工信息」表，找到刚刚添加的记录，修改：
- 姓名
- 邮箱
- 部门
- 职位
- 角色（员工/主管/管理员）

#### 5. 重新登录

访问 http://localhost:3000/login，使用飞书账号登录即可。

---

### 方法二：使用测试账号

系统已预置测试用户，但这些用户的user_id是虚拟的，无法真正登录。

查看测试用户：
```bash
cd backend
npm run check:employees
```

你需要在飞书表格中将某个测试用户的「用户ID」字段修改为你的真实飞书用户ID。

---

## 验证

成功登录后，你应该能看到：
- ✅ 系统主页/仪表盘
- ✅ 左侧导航菜单
- ✅ 右上角显示你的信息和退出按钮

---

## 常见问题

### Q: 如何获取飞书用户ID？
A: 用户ID是飞书分配给每个用户的唯一标识，格式为 `ou_` 开头。通过上述步骤1-2获取。

### Q: 为什么不能直接使用测试账号登录？
A: 测试账号的用户ID是虚构的（如 `ou_test_admin`），而飞书登录时会返回你真实的用户ID。只有表中的用户ID与你的真实ID匹配才能登录。

### Q: 我添加了用户ID，但还是登录失败？
A: 请检查：
1. 用户ID是否完全一致（区分大小写）
2. 「状态」字段是否为「在职」
3. 是否已保存表格更改
4. 清除浏览器缓存后重试

### Q: 如何给团队其他成员添加权限？
A:
1. 让每个成员按照方法一获取自己的用户ID
2. 管理员在「员工信息」表中添加记录
3. 填写完整信息并设置合适的角色

---

## 查看所有用户

```bash
cd backend
npm run check:employees
```

这会列出「员工信息」表中的所有用户。

---

## 技术说明

- **后端端口**: 3001
- **前端端口**: 3000
- **数据存储**: 飞书多维表格 Bitable
- **认证方式**: 飞书 OAuth 2.0 + JWT Token

服务已启动，访问 http://localhost:3000 开始使用！
